<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Perceptrón Visual</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      margin: 30px;
    }
    canvas {
      max-width: 500px;
    }
    label, input, select, button {
      margin: 5px;
      padding: 5px;
      font-size: 1rem;
    }
  </style>
</head>
<body>
  <h1>Entrenamiento del Perceptrón</h1>

  <label for="dataset">Selecciona un dataset:</label>
  <select id="dataset">
    <option value="and">AND</option>
    <option value="xor">XOR</option>
  </select><br>

  <label for="eta">Tasa de aprendizaje (η):</label>
  <input type="number" id="eta" step="0.01" value="0.1" /><br>

  <label for="cota">Cota de iteraciones:</label>
  <input type="number" id="cota" value="100" /><br>

  <button onclick="iniciarEntrenamiento()">Iniciar entrenamiento</button>

  <p id="resultado"></p>

  <canvas id="grafico" width="400" height="400"></canvas>

  <script>
    const canvas = document.getElementById("grafico");
    const ctx = canvas.getContext("2d");
    let chart;

    const datasets = {
      and: {
        x: [[-1, 1], [1, -1], [-1, -1], [1, 1]],
        y: [-1, -1, -1, 1]
      },
      xor: {
        x: [[-1, 1], [1, -1], [-1, -1], [1, 1]],
        y: [1, 1, -1, -1]
      }
    };

    function signo(h) {
      return h >= 0 ? 1 : -1;
    }

    function errorAbsoluto(x, y, w) {
      let error = 0;
      for (let i = 0; i < x.length; i++) {
        const entrada = [...x[i], 1];
        const salida = signo(dot(entrada, w));
        error += Math.abs(y[i] - salida);
      }
      return error;
    }

    function dot(a, b) {
      return a.reduce((acc, val, i) => acc + val * b[i], 0);
    }

    function graficar(x, y, w, iter) {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.save();
      ctx.translate(200, 200);
      ctx.scale(50, -50);

      // Puntos
      for (let i = 0; i < x.length; i++) {
        ctx.beginPath();
        ctx.arc(x[i][0], x[i][1], 0.1, 0, 2 * Math.PI);
        ctx.fillStyle = y[i] === 1 ? "green" : "red";
        ctx.fill();
      }

      // Recta
      if (w[1] !== 0) {
        ctx.beginPath();
        ctx.moveTo(-2, -(w[0] * -2 + w[2]) / w[1]);
        ctx.lineTo(2, -(w[0] * 2 + w[2]) / w[1]);
        ctx.strokeStyle = "black";
        ctx.lineWidth = 0.05;
        ctx.stroke();
      }

      ctx.restore();
    }

    async function perceptronSimple(x, y, eta, cota) {
      let w = [0, 0, 1];
      let error = Infinity;
      let i = 0;
      const xExt = x.map(p => [...p, 1]);
      let errorMin = Infinity;
      let wMin = [...w];

      while (error > 0 && i < cota) {
        const idx = Math.floor(Math.random() * x.length);
        const salida = signo(dot(xExt[idx], w));
        const delta = xExt[idx].map(val => eta * (y[idx] - salida) * val);
        w = w.map((wi, j) => wi + delta[j]);
        error = errorAbsoluto(x, y, w);

        if (error < errorMin) {
          errorMin = error;
          wMin = [...w];
        }

        if (i % 10 === 0) {
          graficar(x, y, w, i);
          await new Promise(res => setTimeout(res, 100));
        }
        i++;
      }

      graficar(x, y, wMin, i);
      document.getElementById("resultado").innerText = `Pesos finales tras ${i} iteraciones: [${wMin.map(n => n.toFixed(2)).join(", ")}] con error ${errorMin}`;
    }

    function iniciarEntrenamiento() {
      const tipo = document.getElementById("dataset").value;
      const eta = parseFloat(document.getElementById("eta").value);
      const cota = parseInt(document.getElementById("cota").value);

      const datos = datasets[tipo];
      perceptronSimple(datos.x, datos.y, eta, cota);
    }
  </script>
</body>
</html>

